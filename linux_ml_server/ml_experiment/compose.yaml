name: ml-experiment-stack
services:
  # Jupyter Notebook with most useful libraries installed.
  # Doc: https://github.com/iot-salzburg/gpu-jupyter
  #
  # Ports mapping:
  # - 8080: Jupyter notebook UI
  # - 8081: Tensorboard UI
  gpu-jupyter:
    container_name: jupyter_env
    build: .
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities:
                - gpu
    ports:
      - 8080:8888
      - 8081:6006
    volumes:
      - ~/data/ml_notebook:/home/jovyan
    environment:
      JUPYTER_ENABLE_LAB: "yes"
      NB_UID: 1000:1000
      NB_GID: 1000:1000
    # Set user and group to 1000 so it's the same as host.
    # This is needed so that files created in docker will be owned by the same user
    # inside and outside of Docker.
    user: 1000:1000
    restart: always

